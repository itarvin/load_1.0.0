/* Scroller Based JRoll.js */
!function(a,b,c){"use strict";function d(a){var b=q.findAllJRolls(a.target),c=b.length;if(!(j.jrollActive&&!j.jrollActive.options.zoom&&a.touches&&a.touches.length>1))if(c){for(;c--;)b[c].moving&&(a.preventDefault(),b[c]._endAction());j.jrollActive=b[0],j.jrollActive._start(a)}else j.jrollActive&&j.jrollActive._end(a)}function e(a){if(j.jrollActive){var c=b.activeElement;j.jrollActive.options.preventDefault&&a.preventDefault(),q.isMobile&&j.jrollActive.options.autoBlur&&("INPUT"===c.tagName||"TEXTAREA"===c.tagName)&&c.blur(),j.jrollActive._move(a)}}function f(a){j.jrollActive&&j.jrollActive._end(a)}function g(){setTimeout(function(){for(var a in n)n[a].refresh().scrollTo(n[a].x,n[a].y,200)},600)}function h(a){var b=q.findScroller(a.target);b&&b._wheel(a)}function i(a,c){b.addEventListener(a,c,!!r&&{passive:!1})}var j,k="2.5.0",l=a.requestAnimationFrame||a.webkitRequestAnimationFrame||function(a){setTimeout(a,17)},m=b.createElement("div").style,n={},o=navigator.userAgent.toLowerCase(),p=function(){for(var a,b=["OT","msT","MozT","webkitT","t"],c=b.length;c--;)if(a=b[c]+"ransform",a in m)return b[c]}(),q={TSF:p+"ransform",TSD:p+"ransitionDuration",TFO:p+"ransformOrigin",isAndroid:/android/.test(o),isIOS:/iphone|ipad/.test(o),isMobile:/mobile|phone|android|pad/.test(o),translateZ:function(a){var b;return b=a?a+"Perspective"in m:"perspective"in m,b?" translateZ(0px)":""}(p.substr(0,p.length-1)),computeTranslate:function(b,c){for(var d,e=0,f=0;b;)d=a.getComputedStyle(b)[q.TSF].replace(/matrix\(|\)/g,"").split(", "),e+=parseInt(d[4])||0,f+=parseInt(d[5])||0,b=b.parentElement,b===c&&(b=null);return{x:e,y:f}},computePosition:function(a,b){for(var c=0,d=0;a;)c+=a.offsetLeft,d+=a.offsetTop,a=a.offsetParent,a===b&&(a=null);return{left:c,top:d}},moveTo:function(a,b,c,d,e){function f(){k-=17,k<=0?(g=b,h=c):(g=parseInt(g+i,10),h=parseInt(h+j,10)),a.style[q.TSF]="translate("+g+"px, "+h+"px)"+q.translateZ+" scale("+p+")",k>0&&(g!==b||h!==c)?l(f):"function"==typeof e&&e()}var g,h,i,j,k,m,n=0,o=0,p=1;m=/translate\(([-\d.]+)px,\s+([-\d.]+)px\)\s+(?:translateZ\(0px\)\s+)?scale\(([\d.]+)\)/.exec(a.style[q.TSF]),m&&(n=Number(m[1]),o=Number(m[2]),p=Number(m[3])),k=d||17,i=(b-n)/(k/17),j=(c-o)/(k/17),g=n,h=o,f()},findScroller:function(a,c){var d;if(c||!("TEXTAREA"===a.tagName&&a.scrollHeight>a.offsetHeight))for(;a!==b;){if(d=a.getAttribute("jroll-id"))return n[d];a=a.parentNode}return null},findAllJRolls:function(a,c){var d,e=[];if(c||!("TEXTAREA"===a.tagName&&a.scrollHeight>a.clientHeight&&a.scrollTop>0&&a.scrollTop<a.scrollHeight-a.clientHeight))for(;a!==b;)d=a.getAttribute("jroll-id"),d&&e.push(n[d]),a=a.parentNode;return e}},r=!1;try{var s=Object.defineProperty({},"passive",{get:function(){r=!0}});a.addEventListener("test",null,s)}catch(a){}i(q.isMobile?"touchstart":"mousedown",d),i(q.isMobile?"touchmove":"mousemove",e),i(q.isMobile?"touchend":"mouseup",f),q.isMobile?i("touchcancel",f):i(/firefox/.test(o)?"DOMMouseScroll":"mousewheel",h),a.addEventListener("resize",g),a.addEventListener("orientationchange",g),j=function(a,c){var d=this;return d.wrapper="string"==typeof a?b.querySelector(a):a,d.scroller=c&&c.scroller?"string"==typeof c.scroller?b.querySelector(c.scroller):c.scroller:d.wrapper.children[0],d.scroller.jroll?(d.scroller.jroll.refresh(),d.scroller.jroll):(d.scroller.jroll=d,void this._init(a,c))},j.version=k,j.utils=q,j.jrollMap=n,j.prototype={_init:function(d,e){var f=this;f.wrapperOffset=q.computePosition(f.wrapper,b.body),f.id=e&&e.id||f.scroller.getAttribute("jroll-id")||"jroll_"+c.random().toString().substr(2,8),f.scroller.setAttribute("jroll-id",f.id),n[f.id]=f,f.options={scrollX:!1,scrollY:!0,scrollFree:!1,minX:null,maxX:null,minY:null,maxY:null,zoom:!1,zoomMin:1,zoomMax:4,zoomDuration:400,bounce:!0,scrollBarX:!1,scrollBarY:!1,scrollBarFade:!1,preventDefault:!0,momentum:!0,autoStyle:!0,autoBlur:!0,edgeRelease:!0};for(var g in e)"scroller"!==g&&(f.options[g]=e[g]);f.options.autoStyle&&("static"===a.getComputedStyle(f.wrapper).position&&(f.wrapper.style.position="relative",f.wrapper.style.top="0",f.wrapper.style.left="0"),f.wrapper.style.overflow="hidden",f.scroller.style.minHeight="100%"),f.scroller.style.touchAction="none",f.x=0,f.y=0,f.s=null,f.scrollBarX=null,f.scrollBarY=null,f._s={startX:0,startY:0,lastX:0,lastY:0,endX:0,endY:0},f._z={spacing:0,scale:1,startScale:1},f._event={scrollStart:[],scroll:[],scrollEnd:[],zoomStart:[],zoom:[],zoomEnd:[],refresh:[],touchEnd:[]},f.refresh(!0)},enable:function(){var a=this;return a.scroller.setAttribute("jroll-id",a.id),a},disable:function(){var a=this;return a.scroller.removeAttribute("jroll-id"),a},destroy:function(){var a=this;delete n[a.id],delete a.scroller.jroll,a.scrollBarX&&a.wrapper.removeChild(a.scrollBarX),a.scrollBarY&&a.wrapper.removeChild(a.scrollBarY),a.disable(),a.scroller.style[q.tSF]="",a.scroller.style[q.tSD]="",a.prototype=null;for(var b in a)a.hasOwnProperty(b)&&delete a[b]},call:function(a,b){var c=this;return c.scrollTo(c.x,c.y),j.jrollActive=a,b&&a._start(b),a},refresh:function(b){var d,e,f,g,h,i,j=this,k=a.getComputedStyle(j.wrapper),l=a.getComputedStyle(j.scroller);return j.wrapperWidth=j.wrapper.clientWidth,j.wrapperHeight=j.wrapper.clientHeight,j.scrollerWidth=c.round(j.scroller.offsetWidth*j._z.scale),j.scrollerHeight=c.round(j.scroller.offsetHeight*j._z.scale),d=parseInt(k["padding-left"])+parseInt(k["padding-right"]),e=parseInt(k["padding-top"])+parseInt(k["padding-bottom"]),f=parseInt(l["margin-left"])+parseInt(l["margin-right"]),g=parseInt(l["margin-top"])+parseInt(l["margin-bottom"]),j.minScrollX=null===j.options.minX?0:j.options.minX,j.maxScrollX=null===j.options.maxX?j.wrapperWidth-j.scrollerWidth-d-f:j.options.maxX,j.minScrollY=null===j.options.minY?0:j.options.minY,j.maxScrollY=null===j.options.maxY?j.wrapperHeight-j.scrollerHeight-e-g:j.options.maxY,j.minScrollX<0&&(j.minScrollX=0),j.minScrollY<0&&(j.minScrollY=0),j.maxScrollX>0&&(j.maxScrollX=0),j.maxScrollY>0&&(j.maxScrollY=0),j._s.endX=j.x,j._s.endY=j.y,j.options.scrollBarX?(j.scrollBarX||(h=j._createScrollBar("jroll-xbar","jroll-xbtn",!1),j.scrollBarX=h[0],j.scrollBtnX=h[1]),j.scrollBarScaleX=j.wrapper.clientWidth/j.scrollerWidth,i=c.round(j.scrollBarX.clientWidth*j.scrollBarScaleX),j.scrollBtnX.style.width=(i>8?i:8)+"px",j._runScrollBarX()):j.scrollBarX&&(j.wrapper.removeChild(j.scrollBarX),j.scrollBarX=null),j.options.scrollBarY?(j.scrollBarY||(h=j._createScrollBar("jroll-ybar","jroll-ybtn",!0),j.scrollBarY=h[0],j.scrollBtnY=h[1]),j.scrollBarScaleY=j.wrapper.clientHeight/j.scrollerHeight,i=c.round(j.scrollBarY.clientHeight*j.scrollBarScaleY),j.scrollBtnY.style.height=(i>8?i:8)+"px",j._runScrollBarY()):j.scrollBarY&&(j.wrapper.removeChild(j.scrollBarY),j.scrollBarY=null),b||j._execEvent("refresh"),j},scale:function(a){var b=this,c=parseFloat(a);return isNaN(c)||(b.scroller.style[q.TFO]="0 0",b._z.scale=c,b.refresh()._scrollTo(b.x,b.y),b.scrollTo(b.x,b.y,400)),b},_wheel:function(a){var b=this,c=a.wheelDelta||120*-(a.detail/3);(b.options.scrollY||b.options.scrollFree)&&b.scrollTo(b.x,b._compute(b.y+c,b.minScrollY,b.maxScrollY))},_runScrollBarX:function(){var a=this,b=c.round(-1*a.x*a.scrollBarScaleX);a._scrollTo.call({scroller:a.scrollBtnX,_z:{scale:1}},b,0)},_runScrollBarY:function(){var a=this,b=c.round(-1*a.y*a.scrollBarScaleY);a._scrollTo.call({scroller:a.scrollBtnY,_z:{scale:1}},0,b)},_createScrollBar:function(a,c,d){var e,f,g=this;return e=b.createElement("div"),f=b.createElement("div"),e.className=a,f.className=c,this.options.scrollBarX!==!0&&this.options.scrollBarY!==!0||(d?(e.style.cssText="position:absolute;top:2px;right:2px;bottom:2px;width:6px;overflow:hidden;border-radius:2px;-webkit-transform: scaleX(.5);transform: scaleX(.5);",f.style.cssText="background:rgba(0,0,0,.4);position:absolute;top:0;left:0;right:0;border-radius:2px;"):(e.style.cssText="position:absolute;left:2px;bottom:2px;right:2px;height:6px;overflow:hidden;border-radius:2px;-webkit-transform: scaleY(.5);transform: scaleY(.5);",f.style.cssText="background:rgba(0,0,0,.4);height:100%;position:absolute;left:0;top:0;bottom:0;border-radius:2px;")),g.options.scrollBarFade&&(e.style.opacity=0),e.appendChild(f),g.wrapper.appendChild(e),[e,f]},_fade:function(a,b){var c=this;c.fading&&b>0&&(b-=25,b%100===0&&(a.style.opacity=b/1e3),l(c._fade.bind(c,a,b)))},on:function(a,b){var c=this;switch(a){case"scrollStart":c._event.scrollStart.push(b);break;case"scroll":c._event.scroll.push(b);break;case"scrollEnd":c._event.scrollEnd.push(b);break;case"zoomStart":c._event.zoomStart.push(b);break;case"zoom":c._event.zoom.push(b);break;case"zoomEnd":c._event.zoomEnd.push(b);break;case"refresh":c._event.refresh.push(b);break;case"touchEnd":c._event.touchEnd.push(b)}return c},_execEvent:function(a,b){for(var c=this,d=c._event[a].length-1;d>=0;d--)c._event[a][d].call(c,b)},_compute:function(a,b,d){var e=this;return a>b?e.options.bounce&&a>b+10?c.round(b+(a-b)/4):b:a<d?e.options.bounce&&a<d-10?c.round(d+(a-d)/4):d:a},_scrollTo:function(a,b){this.scroller.style[q.TSF]="translate("+a+"px, "+b+"px)"+q.translateZ+" scale("+this._z.scale+")"},scrollTo:function(a,b,c,d,e,f,g){var h=this;return d?(h.x=a,h.y=b):(a>=h.minScrollX?(h.x=h.minScrollX,g&&(h._s.startX=g[0].pageX,h._s.endX=h.minScrollX)):a<=h.maxScrollX?(h.x=h.maxScrollX,g&&(h._s.startX=g[0].pageX,h._s.endX=h.maxScrollX)):h.x=a,b>=h.minScrollY?(h.y=h.minScrollY,g&&(h._s.startY=g[0].pageY,h._s.endY=h.minScrollY)):b<=h.maxScrollY?(h.y=h.maxScrollY,g&&(h._s.startY=g[0].pageY,h._s.endY=h.maxScrollY)):h.y=b),f||(h._s.endX=h.x,h._s.endY=h.y),c?q.moveTo(h.scroller,h.x,h.y,c,e):(h._scrollTo(h.x,h.y),"function"==typeof e&&e()),h.scrollBtnX&&h._runScrollBarX(),h.scrollBtnY&&h._runScrollBarY(),h},scrollToElement:function(a,b){var c=this,d="string"==typeof a?c.scroller.querySelector(a):a;if(d instanceof HTMLElement){var e=q.computePosition(d,c.scroller),f=q.computeTranslate(d,c.scroller),g=-(e.left+f.x),h=-(e.top+f.y);return c.scrollTo(g,h,b)}},_endAction:function(){var a=this;a._s.endX=a.x,a._s.endY=a.y,a.moving=!1,a.options.scrollBarFade&&!a.fading&&(a.fading=!0,a.scrollBarX&&a._fade(a.scrollBarX,2e3),a.scrollBarY&&a._fade(a.scrollBarY,2e3)),a._execEvent("scrollEnd")},_stepBounce:function(){function a(){b.scrollTo(b.x,b.y,300)}var b=this;b.bouncing=!1,"scrollY"===b.s?1===b.directionY?(b.scrollTo(b.x,b.minScrollY+15,100,!0,a),b.y=b.minScrollY):(b.scrollTo(b.x,b.maxScrollY-15,100,!0,a),b.y=b.maxScrollY):"scrollX"===b.s&&(1===b.directionX?(b.scrollTo(b.minScrollX+15,b.y,100,!0,a),b.x=b.minScrollX):(b.scrollTo(b.maxScrollX-15,b.y,100,!0,a),b.x=b.maxScrollX))},_x:function(a){var b=this,c=b.directionX*a;isNaN(c)||(b.x=b.x+c,(b.x>=b.minScrollX||b.x<=b.maxScrollX)&&(b.moving=!1,b.options.bounce&&(b.bouncing=!0)))},_y:function(a){var b=this,c=b.directionY*a;isNaN(c)||(b.y=b.y+c,(b.y>=b.minScrollY||b.y<=b.maxScrollY)&&(b.moving=!1,b.options.bounce&&(b.bouncing=!0)))},_xy:function(a){var b=this,d=c.round(b.cosX*a),e=c.round(b.cosY*a);isNaN(d)||isNaN(e)||(b.x=b.x+d,b.y=b.y+e,(b.x>=b.minScrollX||b.x<=b.maxScrollX)&&(b.y>=b.minScrollY||b.y<=b.maxScrollY)&&(b.moving=!1))},_step:function(a){var b=this,d=Date.now(),e=d-a,f=0;if(b.bouncing&&b._stepBounce(),!b.moving)return void b._endAction();if(e>10){if(b.speed=b.speed-e*(b.speed>1.2?.001:b.speed>.6?8e-4:6e-4),f=c.round(b.speed*e),b.speed<=0||f<=0)return void b._endAction();a=d,b._do(f),b.scrollTo(b.x,b.y,0,!1,null,!0),b._execEvent("scroll")}l(b._step.bind(b,a))},_doScroll:function(b,c){var d,e=this;e.distance=b,e.options.bounce&&(e.x=e._compute(e.x,e.minScrollX,e.maxScrollX),e.y=e._compute(e.y,e.minScrollY,e.maxScrollY)),e.scrollTo(e.x,e.y,0,e.options.bounce,null,!0,c.touches||[c]),e._execEvent("scroll",c),c&&c.touches&&e.options.edgeRelease&&(d=c.touches[0].pageY,(d<=10||d>=a.innerHeight-10)&&e._end(c))},_yTextarea:function(a){var b=this,c=a.target;return!("TEXTAREA"===c.tagName&&c.scrollHeight>c.clientHeight&&(0===c.scrollTop&&b.directionY===-1||c.scrollTop===c.scrollHeight-c.clientHeight&&1===b.directionY))||(b._end(a,!0),!1)},_start:function(a){var d=this,e=a.touches||[a];if(d.options.zoom&&e.length>1){d.s="preZoom",d.scroller.style[q.TFO]="0 0";var f=c.abs(e[0].pageX-e[1].pageX),g=c.abs(e[0].pageY-e[1].pageY);return d._z.spacing=c.sqrt(f*f+g*g),d._z.startScale=d._z.scale,d.originX=(e[0].pageX-e[1].pageX)/2+e[1].pageX-(q.computePosition(d.scroller,b.body).left+q.computeTranslate(d.scroller,b.body).x),d.originY=(e[0].pageY-e[1].pageY)/2+e[1].pageY-(q.computePosition(d.scroller,b.body).top+q.computeTranslate(d.scroller,b.body).y),void d._execEvent("zoomStart",a)}if(d.options.scrollBarFade&&(d.fading=!1,d.scrollBarX&&(d.scrollBarX.style.opacity=1),d.scrollBarY&&(d.scrollBarY.style.opacity=1)),d.options.scrollFree)d._do=d._xy,d.s="scrollFree";else if(d.options.scrollX&&d.options.scrollY)d.s="preScroll";else if(!d.options.scrollX&&d.options.scrollY)d._do=d._y,d.s="scrollY";else{if(!d.options.scrollX||d.options.scrollY)return void(d.s=null);d._do=d._x,d.s="scrollX"}d.distance=0,d.lastMoveTime=d.startTime=Date.now(),d._s.lastX=d.startPositionX=d._s.startX=e[0].pageX,d._s.lastY=d.startPositionY=d._s.startY=e[0].pageY,d._execEvent("scrollStart",a)},_move:function(a){var b,d,e,f,g,h,i,j,k=this,l=a.touches||[a],m=1,n=1;if("preScroll"!==k.s&&"scrollX"!==k.s&&"scrollFree"!==k.s||(d=l[0].pageX),"preScroll"!==k.s&&"scrollY"!==k.s&&"scrollFree"!==k.s||(e=l[0].pageY),f=d-k._s.lastX,g=e-k._s.lastY,k._s.lastX=d,k._s.lastY=e,m=f>=0?1:-1,n=g>=0?1:-1,b=Date.now(),(b-k.lastMoveTime>200||k.directionX!==m||k.directionY!==n)&&(k.startTime=b,k.startPositionX=d,k.startPositionY=e,k.directionX=m,k.directionY=n),k.lastMoveTime=b,h=d-k.startPositionX,i=e-k.startPositionY,"preScroll"===k.s){if(c.abs(e-k._s.startY)>=c.abs(d-k._s.startX))return k._do=k._y,void(k.s="scrollY");if(c.abs(e-k._s.startY)<c.abs(d-k._s.startX))return k._do=k._x,void(k.s="scrollX")}if("scrollY"===k.s)return k.y=e-k._s.startY+k._s.endY,void(k._yTextarea(a)&&k._doScroll(i,a));if("scrollX"===k.s)return k.x=d-k._s.startX+k._s.endX,void k._doScroll(h,a);if("scrollFree"===k.s)return k.x=d-k._s.startX+k._s.endX,k.y=e-k._s.startY+k._s.endY,j=c.sqrt(h*h+i*i),k.cosX=h/j,k.cosY=i/j,void k._doScroll(c.sqrt(h*h+i*i),a);if("preZoom"===k.s){var o,p=c.abs(l[0].pageX-l[1].pageX),q=c.abs(l[0].pageY-l[1].pageY),r=c.sqrt(p*p+q*q),s=r/k._z.spacing*k._z.startScale;return s<k.options.zoomMin?s=k.options.zoomMin:s>k.options.zoomMax&&(s=k.options.zoomMax),o=s/k._z.startScale,k.x=c.round(k.originX-k.originX*o+k._s.endX),k.y=c.round(k.originY-k.originY*o+k._s.endY),k._z.scale=s,k._scrollTo(k.x,k.y),void k._execEvent("zoom",a)}},_end:function(a,b){var d,e,f=this,g=Date.now(),h="scrollY"===f.s,i="scrollX"===f.s,k="scrollFree"===f.s;if(h||i||k){if(a.touches&&a.touches.length&&!b)return;return f._execEvent("touchEnd"),j.jrollActive=null,f.duration=g-f.startTime,d=f.y>f.minScrollY||f.y<f.maxScrollY,e=f.x>f.minScrollX||f.x<f.maxScrollX,void(h&&d||i&&e||k&&(d||e)?f.scrollTo(f.x,f.y,300)._endAction():f.options.momentum&&f.duration<200&&f.distance?(f.speed=c.abs(f.distance/f.duration),f.speed=f.speed>2?2:f.speed,f.moving=!0,l(f._step.bind(f,g))):f._endAction())}if("preZoom"===f.s)return f._execEvent("touchEnd"),j.jrollActive=null,f._z.scale>f.options.zoomMax?f._z.scale=f.options.zoomMax:f._z.scale<f.options.zoomMin&&(f._z.scale=f.options.zoomMin),f.refresh(),f.scrollTo(f.x,f.y,f.options.zoomDuration),void f._execEvent("zoomEnd")}},"undefined"!=typeof module&&module.exports&&(module.exports=j),"function"==typeof define&&define(function(){return j}),a.JRoll=j}(window,document,Math),+function(a){var b={inner:!1,bind:""};a.fn.scroller=function(c){return this.each(function(){if(this){var d,e=a(this),f=e.data("scroller");if(!f){var g=a.extend(b,c);if(g.inner&&0===a(this).children(".kui-content-inner").size()){a('<div class="kui-content-inner" />');e.wrapInner('<div class="kui-content-inner" />')}d=new JRoll(this,g),e.data("scroller",d).css({overflow:"hidden"});var h=["scrollStart","scroll","scrollEnd","touchEnd","zoomStart","zoomEnd","refresh"];a.each(h,function(b,c){d.on(c,function(b){e.trigger(a.Event(c))})});var i=["refresh","scrollTo","scrollToElement","disable","enable","destroy","scale","call"];a.each(i,function(a,b){e.constructor.prototype[b]=function(){d[b].apply(d,arguments)}})}return d}})}}(Zepto);